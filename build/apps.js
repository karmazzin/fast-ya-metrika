var _AnalyticsCode="UA-44401879-2",_gaq=_gaq||[];_gaq.push(["_setAccount",_AnalyticsCode]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
!function(r){"use strict";r.config(["$httpProvider","$urlRouterProvider","$akChromeProvider",function(r,e,o){r.interceptors.push("jsonpInterceptor"),e.otherwise(function(r){var e=r.get("$state");e.go("main")}),o.setBadgeColor({color:[0,0,0,190]})}]).run(["$state","$rootScope",function(r,e){e.$on("$stateChangeSuccess",function(e,o,t,n,s){r.previous=n,r.previous.params=s})}])}(angular.module("metrikangular",["ngStorage","ngResource","ui.router","metrikangular.dash","jsonpFix","messages","macros","ak.chrome"]));
!function(e){"use strict";e.directive("messagesAlert",[function(){return{restrict:"E",scope:{aMessages:"=messages"},template:'<div ng-repeat="oMessage in aMessages" class="alert" ng-class="[\'alert-\' + (oMessage.type || \'warning\')]" role="alert">\n    <button type="button" class="close" ng-click="close($index)">\n        <span aria-hidden="true">&times;</span>\n    </button>\n    <div ng-bind="oMessage.text"></div>\n</div>\n',controller:["$scope",function(e){e.close=function(s){e.aMessages[s].callback(),e.aMessages.splice(s,1)}}]}}])}(angular.module("messages",[]));
!function(r){"use strict";r.filter("cut",function(){return function(r,t,n,u){if(!r)return"";if(n=parseInt(n,10),!n)return r;if(r.length<=n)return r;if(r=r.substr(0,n),t){var e=r.lastIndexOf(" ");-1!=e&&(r=r.substr(0,e))}return r+(u||" …")}}).filter("yandexDate",["$filter",function(){return function(r){return null==r?"":r.substr(6,2)+"."+r.substr(4,2)+"."+r.substr(2,2)}}])}(angular.module("macros",[]));
"use strict";!function(e,t){e.provider("$akChrome",function(){var e=this;this.setBadgeColor=t.browserAction.setBadgeBackgroundColor,this.setBadgeText=function(e){null==e&&(e=""),t.browserAction.setBadgeText({text:e+""})},this.$get=function(){function t(){this.setBadgeColor=e.setBadgeColor,this.setBadgeText=e.setBadgeText}return new t}})}(angular.module("ak.chrome",[]),chrome);
!function(e){"use strict";e.factory("jsonpInterceptor",["$timeout","$window","$q",function(e,a,r){var n=0;return{request:function(r){if("JSONP"===r.method){var c=n.toString(36);n++,r.callbackName="angularcallbacks_"+c,r.url=r.url.replace("JSON_CALLBACK",r.callbackName),e(function(){a[r.callbackName]=angular.callbacks["_"+c]},0,!1)}return r},response:function(e){var r=e.config;return"JSONP"===r.method&&delete a[r.callbackName],e},responseError:function(e){var n=e.config;return"JSONP"===n.method&&delete a[n.callbackName],r.reject(e)}}}])}(angular.module("jsonpFix",[]));
"use strict";angular.module("metrikangular.dash",[]).config(["$stateProvider",function(e){e.state("main",{url:"/main",controllerAs:"main",controller:"metrikangular.dash.main",templateUrl:"theme/templates/dash/main.html",resolve:{},data:{viewTitle:"Dashboard"}})}]).controller("metrikangular.dash.main",["$localStorage","$resource","$interval","$timeout","$akChrome",function(e,t,n,a,r){var s=this;s.messages=[],e.gaFirst||(_gaq.push(["_trackEvent","Alert","Info","First open "+new Date]),e.gaFirst=!0);var o=t("https://api-metrika.yandex.ru/counters.json",{callback:"JSON_CALLBACK"},{get:{method:"JSONP"}}),c=t("https://api-metrika.yandex.ru/stat/traffic/summary.json?id=:id",{callback:"JSON_CALLBACK"},{get:{method:"JSONP"}});s.fnGetCountersList=function(t){t&&_gaq.push(["_trackEvent","Action","Clear cache button"]),s.messages=[],o.get({},function(n){s.counters=e.counters=n.counters,!e.manyAlert&&s.counters.length>50&&(s.messages.push({type:"info",text:"У вас большое количество счетчиков, а API Я.Метрики имеет ограничение на лимиты в количестве запросов. Если у вас возникнут проблемы с работой расширения,пожалуйста, дайте знать.",callback:function(){e.manyAlert=!0}}),_gaq.push(["_trackEvent","Info","Many counters "+s.counters.length])),s.fnGetCountersDetail(t)},function(){s.counters=e.counters=null,s.messages.push({type:"danger",text:"Непредвиденная ошибка, попробуйте авторизоваться в Яндексе",callback:function(){}}),_gaq.push(["_trackEvent","Error","Counters list error"])})},s.fnGetCountersDetail=function(t){function a(e){c.get({id:s.counters[e].id},function(t){s.counters[e].traffic=t},function(){u||(u=!0,n.cancel(i),s.messages.push({type:"danger",text:"Непредвиденная ошибка, попробуйте сбросить кеш",callback:function(){}}),_gaq.push(["_trackEvent","Error","Counters detail error"]))})}if(r.setBadgeText(s.counters.length),!e.ttl||new Date(e.ttl)<new Date||t)var o=0,u=!1,i=n(function(){o<s.counters.length?(a(o),o++):(e.response_date=s.response_date=new Date,e.ttl=new Date(s.response_date.getTime()+6e4),n.cancel(i))},20);else s.response_date=new Date(e.response_date)},r.setBadgeText("..."),a(function(){e.counters&&e.counters.length?(s.counters=e.counters,s.fnGetCountersDetail()):s.fnGetCountersList()},100)}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuYWx5dGljcy5qcyIsImFwcC5qcyIsImRpcmVjdGl2ZXMvbWVzc2FnZXMuanMiLCJmaWx0ZXJzL21hY3Jvcy5qcyIsInNlcnZpY2VzL2FrQ2hyb21lLmpzIiwic2VydmljZXMvanNvbnBJbnRlcmNlcHRvci5qcyIsIm1vZHVsZXMvZGFzaC9kYXNoLmpzIl0sIm5hbWVzIjpbIl9BbmFseXRpY3NDb2RlIiwiX2dhcSIsInB1c2giLCJnYSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInR5cGUiLCJhc3luYyIsInNyYyIsInMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiLCJhcHAiLCJjb25maWciLCIkaHR0cFByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwiJGFrQ2hyb21lUHJvdmlkZXIiLCJpbnRlcmNlcHRvcnMiLCJvdGhlcndpc2UiLCIkaW5qZWN0b3IiLCIkc3RhdGUiLCJnZXQiLCJnbyIsInNldEJhZGdlQ29sb3IiLCJjb2xvciIsInJ1biIsIiRyb290U2NvcGUiLCIkb24iLCJldmVudCIsInRvU3RhdGUiLCJ0b1BhcmFtcyIsImZyb21TdGF0ZSIsImZyb21QYXJhbXMiLCJwcmV2aW91cyIsInBhcmFtcyIsImFuZ3VsYXIiLCJtb2R1bGUiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsInNjb3BlIiwiYU1lc3NhZ2VzIiwidGVtcGxhdGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiY2xvc2UiLCIkaW5kZXgiLCJjYWxsYmFjayIsInNwbGljZSIsImZpbHRlciIsInZhbHVlIiwid29yZHdpc2UiLCJtYXgiLCJ0YWlsIiwicGFyc2VJbnQiLCJsZW5ndGgiLCJzdWJzdHIiLCJsYXN0c3BhY2UiLCJsYXN0SW5kZXhPZiIsImlucHV0IiwiY2hyb21lIiwicHJvdmlkZXIiLCJzZWxmIiwidGhpcyIsImJyb3dzZXJBY3Rpb24iLCJzZXRCYWRnZUJhY2tncm91bmRDb2xvciIsInNldEJhZGdlVGV4dCIsInRleHQiLCIkZ2V0IiwiQ2hyb21lIiwiZmFjdG9yeSIsIiR0aW1lb3V0IiwiJHdpbmRvdyIsIiRxIiwibGFzdF9pZCIsInJlcXVlc3QiLCJtZXRob2QiLCJjYWxsYmFja0lkIiwidG9TdHJpbmciLCJjYWxsYmFja05hbWUiLCJ1cmwiLCJyZXBsYWNlIiwiY2FsbGJhY2tzIiwicmVzcG9uc2UiLCJyZXNwb25zZUVycm9yIiwicmVqZWN0aW9uIiwicmVqZWN0IiwiJHN0YXRlUHJvdmlkZXIiLCJzdGF0ZSIsImNvbnRyb2xsZXJBcyIsInRlbXBsYXRlVXJsIiwicmVzb2x2ZSIsImRhdGEiLCJ2aWV3VGl0bGUiLCIkbG9jYWxTdG9yYWdlIiwiJHJlc291cmNlIiwiJGludGVydmFsIiwiJGFrQ2hyb21lIiwiY3RybCIsIm1lc3NhZ2VzIiwiZ2FGaXJzdCIsIkRhdGUiLCJDb3VudGVycyIsIkNvdW50ZXJfaW5mbyIsImZuR2V0Q291bnRlcnNMaXN0IiwiY2xlYXJfY2FjaGUiLCJjb3VudGVycyIsIm1hbnlBbGVydCIsImZuR2V0Q291bnRlcnNEZXRhaWwiLCJsb29wIiwiaSIsImlkIiwidHJhZmZpYyIsImlzRXJyb3IiLCJjYW5jZWwiLCJzdG9wIiwidHRsIiwicmVzcG9uc2VfZGF0ZSIsImdldFRpbWUiXSwibWFwcGluZ3MiOiJBQU9BLEdBQUlBLGdCQUFpQixnQkFRakJDLEtBQU9BLFFBQ1hBLE1BQUtDLE1BQU0sY0FBZUYsaUJBQzFCQyxLQUFLQyxNQUFNLG1CQUVYLFdBQ0ksR0FBSUMsR0FBS0MsU0FBU0MsY0FBYyxTQUNoQ0YsR0FBR0csS0FBTyxrQkFDVkgsRUFBR0ksT0FBUSxFQUNYSixFQUFHSyxJQUFNLHdDQUNULElBQUlDLEdBQUlMLFNBQVNNLHFCQUFxQixVQUFVLEVBQ2hERCxHQUFFRSxXQUFXQyxhQUFhVCxFQUFJTTtDQ3pCakMsU0FBU0ksR0FBTyxZQUVqQkEsR0FDQ0MsUUFDRyxnQkFDQSxxQkFDQSxvQkFDQSxTQUFTQyxFQUFlQyxFQUFvQkMsR0FDeENGLEVBQWNHLGFBQWFoQixLQUFL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LFNBQVU2RCxLQUFNLDZEQUE4RHBCLFNBQVUsZUFDbEg5QyxLQUFLQyxNQUFNLGNBQWUsUUFBUywyQkFJM0NnRyxFQUFLVSxvQkFBc0IsU0FBU0gsR0FvQmhDLFFBQVNJLEdBQUtDLEdBQ1ZQLEVBQWFqRixLQUFLeUYsR0FBSWIsRUFBS1EsU0FBU0ksR0FBR0MsSUFBSyxTQUFTNUIsR0FDakRlLEVBQUtRLFNBQVNJLEdBQUdFLFFBQVU3QixHQUU1QixXQUNNOEIsSUFFREEsR0FBVSxFQUNWakIsRUFBVWtCLE9BQU9DLEdBRWpCakIsRUFBS0MsU0FBU2pHLE1BQU1JLEtBQU0sU0FBVTZELEtBQU0saURBQWtEcEIsU0FBVSxlQUN0RzlDLEtBQUtDLE1BQU0sY0FBZSxRQUFTLDZCQTdCL0MsR0FEQStGLEVBQVUvQixhQUFhZ0MsRUFBS1EsU0FBU25ELFNBQ2hDdUMsRUFBY3NCLEtBQU8sR0FBSWYsTUFBS1AsRUFBY3NCLEtBQU8sR0FBSWYsT0FBVUksRUFFbEUsR0FBSUssR0FBSSxFQUNKRyxHQUFVLEVBQ1ZFLEVBQU9uQixFQUFVLFdBQ2JjLEVBQUlaLEVBQUtRLFNBQVNuRCxRQUNsQnNELEVBQUtDLEdBQ0xBLE1BRUFoQixFQUFjdUIsY0FBZ0JuQixFQUFLbUIsY0FBZ0IsR0FBSWhCLE1BQ3ZEUCxFQUFjc0IsSUFBTSxHQUFJZixNQUFLSCxFQUFLbUIsY0FBY0MsVUFBWSxLQUM1RHRCLEVBQVVrQixPQUFPQyxLQUV0QixRQUVIakIsR0FBS21CLGNBQWdCLEdBQUloQixNQUFLUCxFQUFjdUIsZ0JBb0JwRHBCLEVBQVUvQixhQUFhLE9BQ3ZCSyxFQUFTLFdBQ0F1QixFQUFjWSxVQUFhWixFQUFjWSxTQUFTbkQsUUFHbkQyQyxFQUFLUSxTQUFXWixFQUFjWSxTQUM5QlIsRUFBS1UsdUJBSExWLEVBQUtNLHFCQUtWIiwiZmlsZSI6ImFwcHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMTIgVGhlIENocm9taXVtIEF1dGhvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4vLyBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLlxuXG4vKipcbiAqIEFkZCB5b3VyIEFuYWx5dGljcyB0cmFja2luZyBJRCBoZXJlLlxuICovXG52YXIgX0FuYWx5dGljc0NvZGUgPSAnVUEtNDQ0MDE4NzktMic7XG4vKipcbiAqIEJlbG93IGlzIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgR29vZ2xlIEFuYWx5dGljcyBhc3luY2hyb25vdXMgdHJhY2tpbmdcbiAqIGNvZGUgc25pcHBldC4gIEl0IGhhcyBiZWVuIG1vZGlmaWVkIHRvIHB1bGwgdGhlIEhUVFBTIHZlcnNpb24gb2YgZ2EuanNcbiAqIGluc3RlYWQgb2YgdGhlIGRlZmF1bHQgSFRUUCB2ZXJzaW9uLiAgSXQgaXMgcmVjb21tZW5kZWQgdGhhdCB5b3UgdXNlIHRoaXNcbiAqIHNuaXBwZXQgaW5zdGVhZCBvZiB0aGUgc3RhbmRhcmQgdHJhY2tpbmcgc25pcHBldCBwcm92aWRlZCB3aGVuIHNldHRpbmcgdXBcbiAqIGEgR29vZ2xlIEFuYWx5dGljcyBhY2NvdW50LlxuICovXG52YXIgX2dhcSA9IF9nYXEgfHwgW107XG5fZ2FxLnB1c2goWydfc2V0QWNjb3VudCcsIF9BbmFseXRpY3NDb2RlXSk7XG5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldyddKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZ2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgZ2EuYXN5bmMgPSB0cnVlO1xuICAgIGdhLnNyYyA9ICdodHRwczovL3NzbC5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7XG4gICAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07XG4gICAgcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShnYSwgcyk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKGFwcCkgeyAndXNlIHN0cmljdCc7XG5cbmFwcFxuLmNvbmZpZyhbXG4gICAgJyRodHRwUHJvdmlkZXInLFxuICAgICckdXJsUm91dGVyUHJvdmlkZXInLFxuICAgICckYWtDaHJvbWVQcm92aWRlcicsXG4gICAgZnVuY3Rpb24oJGh0dHBQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyLCAkYWtDaHJvbWVQcm92aWRlcikge1xuICAgICAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdqc29ucEludGVyY2VwdG9yJyk7XG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoIGZ1bmN0aW9uKCRpbmplY3Rvcikge1xuICAgICAgICAgICAgdmFyICRzdGF0ZSA9ICRpbmplY3Rvci5nZXQoXCIkc3RhdGVcIik7XG4gICAgICAgICAgICAkc3RhdGUuZ28oXCJtYWluXCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgJGFrQ2hyb21lUHJvdmlkZXIuc2V0QmFkZ2VDb2xvcih7Y29sb3I6WzAsIDAsIDAsIDE5MF19KTtcbiAgICB9XSlcblxuLnJ1bihbXG4gICAgJyRzdGF0ZScsXG4gICAgJyRyb290U2NvcGUnLFxuICAgIGZ1bmN0aW9uKCRzdGF0ZSwgJHJvb3RTY29wZSkge1xuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uKGV2ZW50LCB0b1N0YXRlLCB0b1BhcmFtcywgZnJvbVN0YXRlLCBmcm9tUGFyYW1zKXtcbiAgICAgICAgICAgICRzdGF0ZS5wcmV2aW91cyA9IGZyb21TdGF0ZTtcbiAgICAgICAgICAgICRzdGF0ZS5wcmV2aW91cy5wYXJhbXMgPSBmcm9tUGFyYW1zO1xuICAgICAgICB9KTtcbiAgICB9XSlcblxufShhbmd1bGFyLm1vZHVsZSgnbWV0cmlrYW5ndWxhcicsIFtcbiAgICAgICAgJ25nU3RvcmFnZScsXG4gICAgICAgICduZ1Jlc291cmNlJyxcbiAgICAgICAgJ3VpLnJvdXRlcicsXG4gICAgICAgICdtZXRyaWthbmd1bGFyLmRhc2gnLFxuICAgICAgICAnanNvbnBGaXgnLFxuICAgICAgICAnbWVzc2FnZXMnLFxuICAgICAgICAnbWFjcm9zJyxcbiAgICAgICAgJ2FrLmNocm9tZSdcbiAgICBdKSkpO1xuIiwiKGZ1bmN0aW9uKG1vZHVsZSl7ICd1c2Ugc3RyaWN0JztcbiAgICAvKipcbiAgICAgQHVzYWdlOlxuICAgICB0ZW1wbGF0ZSBleGFtcGxlOlxuICAgICA8bWVzc2FnZXMtYWxlcnQgbWVzc2FnZXM9XCJhTWVzc2FnZXNcIj48L21lc3NhZ2VzLWFsZXJ0PlxuXG4gICAgIGVtYXhwbGUgaW4gY29kZTpcbiAgICAgJHNjb3BlLmFNZXNzYWdlcy5wdXNoKHt0eXBlOidkYW5nZXInLHRleHQ6ICdFcnJvciB0ZXh0J30pXG5cbiAgICAgYU1lc3NhZ2VzIGFycmF5IFt7dHlwZSwgdGV4dH1dXG4gICAgICovXG5cbiAgICBtb2R1bGUuZGlyZWN0aXZlKCdtZXNzYWdlc0FsZXJ0JywgW1xuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlc3RyaWN0OidFJyxcbiAgICAgICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgICAgICBhTWVzc2FnZXM6ICc9bWVzc2FnZXMnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogXCI8ZGl2IG5nLXJlcGVhdD1cXFwib01lc3NhZ2UgaW4gYU1lc3NhZ2VzXFxcIiBjbGFzcz1cXFwiYWxlcnRcXFwiIG5nLWNsYXNzPVxcXCJbJ2FsZXJ0LScgKyAob01lc3NhZ2UudHlwZSB8fCAnd2FybmluZycpXVxcXCIgcm9sZT1cXFwiYWxlcnRcXFwiPlxcblwiICtcbiAgICAgICAgICAgICAgICAgICAgXCIgICAgPGJ1dHRvbiB0eXBlPVxcXCJidXR0b25cXFwiIGNsYXNzPVxcXCJjbG9zZVxcXCIgbmctY2xpY2s9XFxcImNsb3NlKCRpbmRleClcXFwiPlxcblwiICtcbiAgICAgICAgICAgICAgICAgICAgXCIgICAgICAgIDxzcGFuIGFyaWEtaGlkZGVuPVxcXCJ0cnVlXFxcIj4mdGltZXM7PC9zcGFuPlxcblwiICtcbiAgICAgICAgICAgICAgICAgICAgXCIgICAgPC9idXR0b24+XFxuXCIgK1xuICAgICAgICAgICAgICAgICAgICBcIiAgICA8ZGl2IG5nLWJpbmQ9XFxcIm9NZXNzYWdlLnRleHRcXFwiPjwvZGl2PlxcblwiICtcbiAgICAgICAgICAgICAgICAgICAgXCI8L2Rpdj5cXG5cIixcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBbJyRzY29wZScsIGZ1bmN0aW9uICgkc2NvcGUpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oJGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYU1lc3NhZ2VzWyRpbmRleF0uY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hTWVzc2FnZXMuc3BsaWNlKCRpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIF0pO1xufShhbmd1bGFyLm1vZHVsZSgnbWVzc2FnZXMnLCBbXSkpKTsiLCIoZnVuY3Rpb24obW9kdWxlKXsgJ3VzZSBzdHJpY3QnO1xuXG5tb2R1bGUuZmlsdGVyKCdjdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSwgd29yZHdpc2UsIG1heCwgdGFpbCkge1xuICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm4gJyc7XG5cbiAgICAgICAgbWF4ID0gcGFyc2VJbnQobWF4LCAxMCk7XG4gICAgICAgIGlmICghbWF4KSByZXR1cm4gdmFsdWU7XG4gICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPD0gbWF4KSByZXR1cm4gdmFsdWU7XG5cbiAgICAgICAgdmFsdWUgPSB2YWx1ZS5zdWJzdHIoMCwgbWF4KTtcbiAgICAgICAgaWYgKHdvcmR3aXNlKSB7XG4gICAgICAgICAgICB2YXIgbGFzdHNwYWNlID0gdmFsdWUubGFzdEluZGV4T2YoJyAnKTtcbiAgICAgICAgICAgIGlmIChsYXN0c3BhY2UgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnN1YnN0cigwLCBsYXN0c3BhY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZhbHVlICsgKHRhaWwgfHwgJyDigKYnKTtcbiAgICB9O1xufSlcbi5maWx0ZXIoJ3lhbmRleERhdGUnLCBbJyRmaWx0ZXInLCBmdW5jdGlvbigkZmlsdGVyKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgIGlmKGlucHV0ID09IG51bGwpeyByZXR1cm4gXCJcIjsgfVxuXG4gICAgICAgIHJldHVybiAgaW5wdXQuc3Vic3RyKDYsMikgKyAnLicgKyBpbnB1dC5zdWJzdHIoNCwyKSArICcuJyArIGlucHV0LnN1YnN0cigyLDIpO1xuICAgIH07XG59XSk7XG5cbn0oYW5ndWxhci5tb2R1bGUoJ21hY3JvcycsIFtdKSkpO1xuXG4iLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbihtb2R1bGUsIGNocm9tZSkge1xuICAgIG1vZHVsZS5wcm92aWRlcignJGFrQ2hyb21lJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICB0aGlzLnNldEJhZGdlQ29sb3IgPSBjaHJvbWUuYnJvd3NlckFjdGlvbi5zZXRCYWRnZUJhY2tncm91bmRDb2xvcjtcbiAgICAgICAgdGhpcy5zZXRCYWRnZVRleHQgPSBmdW5jdGlvbih0ZXh0KSB7XG4gICAgICAgICAgICBpZiAodGV4dCA9PSBudWxsKSB0ZXh0ID0gJyc7XG4gICAgICAgICAgICBjaHJvbWUuYnJvd3NlckFjdGlvbi5zZXRCYWRnZVRleHQoe3RleHQ6IHRleHQgKyAnJ30pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuJGdldCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBDaHJvbWUoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRCYWRnZUNvbG9yID0gc2VsZi5zZXRCYWRnZUNvbG9yO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0QmFkZ2VUZXh0ID0gc2VsZi5zZXRCYWRnZVRleHQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgQ2hyb21lKCk7XG5cbiAgICAgICAgfTtcblxuICAgIH0pO1xuXG59KGFuZ3VsYXIubW9kdWxlKCdhay5jaHJvbWUnLCBbXSksIGNocm9tZSkpOyIsIihmdW5jdGlvbihtb2R1bGUpeyAndXNlIHN0cmljdCc7XG4gICAgbW9kdWxlLmZhY3RvcnkoJ2pzb25wSW50ZXJjZXB0b3InLCBbJyR0aW1lb3V0JywgJyR3aW5kb3cnLCAnJHEnLCBmdW5jdGlvbigkdGltZW91dCwgJHdpbmRvdywgJHEpIHtcbiAgICAgICAgdmFyIGxhc3RfaWQgPSAwO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJ3JlcXVlc3QnOiBmdW5jdGlvbihjb25maWcpIHtcblxuICAgICAgICAgICAgICAgIGlmIChjb25maWcubWV0aG9kID09PSAnSlNPTlAnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjYWxsYmFja0lkID0gbGFzdF9pZC50b1N0cmluZygzNik7XG4gICAgICAgICAgICAgICAgICAgIGxhc3RfaWQrKztcblxuICAgICAgICAgICAgICAgICAgICBjb25maWcuY2FsbGJhY2tOYW1lID0gJ2FuZ3VsYXJjYWxsYmFja3NfJyArIGNhbGxiYWNrSWQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy51cmwgPSBjb25maWcudXJsLnJlcGxhY2UoJ0pTT05fQ0FMTEJBQ0snLCBjb25maWcuY2FsbGJhY2tOYW1lKTtcblxuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICR3aW5kb3dbY29uZmlnLmNhbGxiYWNrTmFtZV0gPSBhbmd1bGFyLmNhbGxiYWNrc1snXycgKyBjYWxsYmFja0lkXTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBjb25maWc7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAncmVzcG9uc2UnOiBmdW5jdGlvbihyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHJlc3BvbnNlLmNvbmZpZztcblxuICAgICAgICAgICAgICAgIGlmIChjb25maWcubWV0aG9kID09PSAnSlNPTlAnKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSAkd2luZG93W2NvbmZpZy5jYWxsYmFja05hbWVdOyAvLyBjbGVhbnVwXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ3Jlc3BvbnNlRXJyb3InOiBmdW5jdGlvbihyZWplY3Rpb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0gcmVqZWN0aW9uLmNvbmZpZztcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLm1ldGhvZCA9PT0gJ0pTT05QJykge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgJHdpbmRvd1tjb25maWcuY2FsbGJhY2tOYW1lXTsgLy8gY2xlYW51cFxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XSlcbn0oYW5ndWxhci5tb2R1bGUoJ2pzb25wRml4JywgW10pKSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnbWV0cmlrYW5ndWxhci5kYXNoJywgW10pXG4uY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcikge1xuICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgIC5zdGF0ZSgnbWFpbicsIHtcbiAgICAgICAgICAgIHVybDogXCIvbWFpblwiLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAnbWFpbicsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBcIm1ldHJpa2FuZ3VsYXIuZGFzaC5tYWluXCIsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ0aGVtZS90ZW1wbGF0ZXMvZGFzaC9tYWluLmh0bWxcIixcbiAgICAgICAgICAgIHJlc29sdmU6IHtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICB2aWV3VGl0bGU6ICdEYXNoYm9hcmQnXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG59XSlcbi5jb250cm9sbGVyKCdtZXRyaWthbmd1bGFyLmRhc2gubWFpbicsIFtcbiAgICAnJGxvY2FsU3RvcmFnZScsXG4gICAgJyRyZXNvdXJjZScsXG4gICAgJyRpbnRlcnZhbCcsXG4gICAgJyR0aW1lb3V0JyxcbiAgICAnJGFrQ2hyb21lJyxcbiAgICBmdW5jdGlvbigkbG9jYWxTdG9yYWdlLCAkcmVzb3VyY2UsICRpbnRlcnZhbCwgJHRpbWVvdXQsICRha0Nocm9tZSkge1xuICAgICAgICB2YXIgY3RybCA9IHRoaXM7XG4gICAgICAgIGN0cmwubWVzc2FnZXMgPSBbXTtcblxuICAgICAgICBpZiAoISRsb2NhbFN0b3JhZ2UuZ2FGaXJzdCkge1xuICAgICAgICAgICAgX2dhcS5wdXNoKFsnX3RyYWNrRXZlbnQnLCAnQWxlcnQnLCAnSW5mbycsICdGaXJzdCBvcGVuICcgKyBuZXcgRGF0ZV0pO1xuICAgICAgICAgICAgJGxvY2FsU3RvcmFnZS5nYUZpcnN0ID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBDb3VudGVycyA9ICRyZXNvdXJjZSgnaHR0cHM6Ly9hcGktbWV0cmlrYS55YW5kZXgucnUvY291bnRlcnMuanNvbicsXG4gICAgICAgICAgICB7Y2FsbGJhY2s6IFwiSlNPTl9DQUxMQkFDS1wifSxcbiAgICAgICAgICAgIHsgZ2V0OiB7IG1ldGhvZDogJ0pTT05QJ319KTtcblxuICAgICAgICB2YXIgQ291bnRlcl9pbmZvID0gJHJlc291cmNlKCdodHRwczovL2FwaS1tZXRyaWthLnlhbmRleC5ydS9zdGF0L3RyYWZmaWMvc3VtbWFyeS5qc29uP2lkPTppZCcsXG4gICAgICAgICAgICB7Y2FsbGJhY2s6IFwiSlNPTl9DQUxMQkFDS1wifSxcbiAgICAgICAgICAgIHsgZ2V0OiB7IG1ldGhvZDogJ0pTT05QJ319KTtcblxuICAgICAgICBjdHJsLmZuR2V0Q291bnRlcnNMaXN0ID0gZnVuY3Rpb24oY2xlYXJfY2FjaGUpIHtcbiAgICAgICAgICAgIGlmIChjbGVhcl9jYWNoZSkgX2dhcS5wdXNoKFsnX3RyYWNrRXZlbnQnLCAnQWN0aW9uJywgJ0NsZWFyIGNhY2hlIGJ1dHRvbiddKTtcblxuICAgICAgICAgICAgY3RybC5tZXNzYWdlcyA9IFtdO1xuXG4gICAgICAgICAgICBDb3VudGVycy5nZXQoe30sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgY3RybC5jb3VudGVycyA9ICRsb2NhbFN0b3JhZ2UuY291bnRlcnMgPSByZXNwb25zZS5jb3VudGVycztcblxuICAgICAgICAgICAgICAgIGlmICghJGxvY2FsU3RvcmFnZS5tYW55QWxlcnQgJiYgY3RybC5jb3VudGVycy5sZW5ndGggPiA1MCkge1xuICAgICAgICAgICAgICAgICAgICBjdHJsLm1lc3NhZ2VzLnB1c2goe3R5cGU6ICdpbmZvJywgdGV4dDogJ9CjINCy0LDRgSDQsdC+0LvRjNGI0L7QtSDQutC+0LvQuNGH0LXRgdGC0LLQviDRgdGH0LXRgtGH0LjQutC+0LIsINCwIEFQSSDQry7QnNC10YLRgNC40LrQuCDQuNC80LXQtdGCICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJ9C+0LPRgNCw0L3QuNGH0LXQvdC40LUg0L3QsCDQu9C40LzQuNGC0Ysg0LIg0LrQvtC70LjRh9C10YHRgtCy0LUg0LfQsNC/0YDQvtGB0L7Qsi4g0JXRgdC70Lgg0YMg0LLQsNGBINCy0L7Qt9C90LjQutC90YPRgiDQv9GA0L7QsdC70LXQvNGLINGBINGA0LDQsdC+0YLQvtC5INGA0LDRgdGI0LjRgNC10L3QuNGPLCcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJ9C/0L7QttCw0LvRg9C50YHRgtCwLCDQtNCw0LnRgtC1INC30L3QsNGC0YwuJywgY2FsbGJhY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2FsU3RvcmFnZS5tYW55QWxlcnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9fSk7XG4gICAgICAgICAgICAgICAgICAgIF9nYXEucHVzaChbJ190cmFja0V2ZW50JywgJ0luZm8nLCAnTWFueSBjb3VudGVycyAnICsgY3RybC5jb3VudGVycy5sZW5ndGhdKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjdHJsLmZuR2V0Q291bnRlcnNEZXRhaWwoY2xlYXJfY2FjaGUpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjdHJsLmNvdW50ZXJzID0gJGxvY2FsU3RvcmFnZS5jb3VudGVycyA9IG51bGw7XG4gICAgICAgICAgICAgICAgY3RybC5tZXNzYWdlcy5wdXNoKHt0eXBlOiAnZGFuZ2VyJywgdGV4dDogJ9Cd0LXQv9GA0LXQtNCy0LjQtNC10L3QvdCw0Y8g0L7RiNC40LHQutCwLCDQv9C+0L/RgNC+0LHRg9C50YLQtSDQsNCy0YLQvtGA0LjQt9C+0LLQsNGC0YzRgdGPINCyINCv0L3QtNC10LrRgdC1JywgY2FsbGJhY2s6IGZ1bmN0aW9uKCkge319KTtcbiAgICAgICAgICAgICAgICBfZ2FxLnB1c2goWydfdHJhY2tFdmVudCcsICdFcnJvcicsICdDb3VudGVycyBsaXN0IGVycm9yJ10pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgY3RybC5mbkdldENvdW50ZXJzRGV0YWlsID0gZnVuY3Rpb24oY2xlYXJfY2FjaGUpIHtcbiAgICAgICAgICAgICRha0Nocm9tZS5zZXRCYWRnZVRleHQoY3RybC5jb3VudGVycy5sZW5ndGgpO1xuICAgICAgICAgICAgaWYgKCEkbG9jYWxTdG9yYWdlLnR0bCB8fCBuZXcgRGF0ZSgkbG9jYWxTdG9yYWdlLnR0bCkgPCBuZXcgRGF0ZSgpIHx8IGNsZWFyX2NhY2hlKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgaSA9IDA7XG4gICAgICAgICAgICAgICAgdmFyIGlzRXJyb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2YXIgc3RvcCA9ICRpbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPCBjdHJsLmNvdW50ZXJzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9vcChpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhbFN0b3JhZ2UucmVzcG9uc2VfZGF0ZSA9IGN0cmwucmVzcG9uc2VfZGF0ZSA9IG5ldyBEYXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2FsU3RvcmFnZS50dGwgPSBuZXcgRGF0ZShjdHJsLnJlc3BvbnNlX2RhdGUuZ2V0VGltZSgpICsgNjAwMDApOy8vb25lIG1pbnV0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChzdG9wKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIDIwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY3RybC5yZXNwb25zZV9kYXRlID0gbmV3IERhdGUoJGxvY2FsU3RvcmFnZS5yZXNwb25zZV9kYXRlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gbG9vcChpKSB7XG4gICAgICAgICAgICAgICAgQ291bnRlcl9pbmZvLmdldCh7aWQ6IGN0cmwuY291bnRlcnNbaV0uaWR9LCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBjdHJsLmNvdW50ZXJzW2ldLnRyYWZmaWMgPSByZXNwb25zZTtcblxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNFcnJvcikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0Vycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoc3RvcCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwubWVzc2FnZXMucHVzaCh7dHlwZTogJ2RhbmdlcicsIHRleHQ6ICfQndC10L/RgNC10LTQstC40LTQtdC90L3QsNGPINC+0YjQuNCx0LrQsCwg0L/QvtC/0YDQvtCx0YPQudGC0LUg0YHQsdGA0L7RgdC40YLRjCDQutC10YgnLCBjYWxsYmFjazogZnVuY3Rpb24oKSB7fX0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2dhcS5wdXNoKFsnX3RyYWNrRXZlbnQnLCAnRXJyb3InLCAnQ291bnRlcnMgZGV0YWlsIGVycm9yJ10pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgJGFrQ2hyb21lLnNldEJhZGdlVGV4dCgnLi4uJyk7XG4gICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCEkbG9jYWxTdG9yYWdlLmNvdW50ZXJzIHx8ICEkbG9jYWxTdG9yYWdlLmNvdW50ZXJzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGN0cmwuZm5HZXRDb3VudGVyc0xpc3QoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY3RybC5jb3VudGVycyA9ICRsb2NhbFN0b3JhZ2UuY291bnRlcnM7XG4gICAgICAgICAgICAgICAgY3RybC5mbkdldENvdW50ZXJzRGV0YWlsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIDEwMCk7XG5cbn1dKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=